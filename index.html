<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tages-Text</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 40px; line-height: 1.4; }
    .box { padding: 16px; border: 1px solid #ddd; border-radius: 12px; max-width: 720px; }
    .meta { color: #666; font-size: 14px; margin-bottom: 10px; }
    .text { white-space: pre-wrap; font-size: 18px; }
  </style>
</head>
<body>
  <div class="box">
    <div class="meta" id="meta">Lade…</div>
    <div class="text" id="text"></div>
  </div>

  <!-- CSV Parser (klein + robust) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    // Datum "heute" in Europe/Berlin als YYYY-MM-DD
    function todayBerlinISO() {
      const parts = new Intl.DateTimeFormat("en-CA", {
        timeZone: "Europe/Berlin",
        year: "numeric",
        month: "2-digit",
        day: "2-digit"
      }).formatToParts(new Date());

      const y = parts.find(p => p.type === "year").value;
      const m = parts.find(p => p.type === "month").value;
      const d = parts.find(p => p.type === "day").value;
      return `${y}-${m}-${d}`;
    }

    async function loadAndShow() {
      const heute = todayBerlinISO();
      document.getElementById("meta").textContent = `Heute: ${heute}`;

      const res = await fetch("./daten.csv", { cache: "no-store" });
      if (!res.ok) throw new Error("daten.csv konnte nicht geladen werden.");

      const csvText = await res.text();
      const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });

      const rows = parsed.data.map(r => ({
        datum: String(r.datum || "").trim(),
        text: String(r.text || "").trim()
      }));

      const hit = rows.find(r => r.datum === heute);

      document.getElementById("text").textContent =
        hit ? hit.text : "Kein Text für heute gefunden.";
    }

    loadAndShow().catch(err => {
      document.getElementById("meta").textContent = "Fehler";
      document.getElementById("text").textContent = err.message;
      console.error(err);
    });
  </script>
</body>
</html>
